(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4318:function(t,e,n){Promise.resolve().then(n.bind(n,9667))},7290:function(t,e,n){"use strict";n.d(e,{R6:function(){return l},jW:function(){return c},o4:function(){return o},pz:function(){return s}});var i=n(6608),r=n(2115),a=n(2344);let o=(0,i.hg)("saveCutout",async(t,e)=>{let n=e.getState().cutouts.cutouts;if(n.length>1){let t=await window.showSaveFilePicker({startIn:"downloads",suggestedName:"cutouts.zip",types:[{description:"zipped",accept:{"application/zip":[".zip"]}}]}),e=await t.createWritable(),i=await Promise.all(n.map(function(t){let{promise:e,resolve:n}=Promise.withResolvers(),i="".concat(t.from_image,"_").concat(t.id,".png");return fetch(t.blobURL).then(async t=>{n(new File([await t.blob()],i))}),e})),r=await (0,a.RZ)(i).blob();await e.write(r),await e.close()}else{let t=n[0],e=await window.showSaveFilePicker({startIn:"downloads",suggestedName:"".concat(t.from_image,"_").concat(t.id,".png"),types:[{description:"png",accept:{"image/png":[".png"]}}]}),i=await e.createWritable(),r=await fetch(t.blobURL).then(async t=>await t.blob());await i.write(r),await i.close()}}),s=(0,i.hg)("addCutout",async(t,e)=>{let n;return n="string"==typeof t.mask?await fetch(t.mask).then(async t=>await t.blob()):t.mask,{id:crypto.randomUUID(),from_image:t.raw.fileHandle.name,blobURL:URL.createObjectURL(n)}}),u=(0,i.oM)({name:"cutout",initialState:{cutouts:[]},reducers:{removeCutout(t,e){let n=t.cutouts.splice((0,r.Js)(t.cutouts).indexOf(e.payload),1);URL.revokeObjectURL(n[0].blobURL)},cleanAllCut:(t,e)=>(t.cutouts.forEach(t=>URL.revokeObjectURL(t.blobURL)),{cutouts:[]})},extraReducers:t=>{t.addCase(s.fulfilled,(t,e)=>{t.cutouts=t.cutouts.concat(e.payload)}),t.addCase(o.fulfilled,(t,e)=>{t.cutouts.splice(0,t.cutouts.length)})}}),{removeCutout:l,cleanAllCut:c}=u.actions;e.ZP=u},9667:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return y}});var i=n(7437),r=n(828),a=n(6608),o=n(7230),s=n(8377),u=n(7290),l=n(66),c=n(6176);let f=()=>{let t=(0,a.xC)({reducer:{rawImages:s.ZP.reducer,cutouts:u.ZP.reducer,editor:l.ZP.reducer,processApi:c.Z.reducer},middleware:t=>t({serializableCheck:!1}).concat(c.Z.middleware)});return(0,o.sj)(t.dispatch),t};n(8431);var d=n(2265),g=n(5313),h=n(4277);function p(t){let{children:e}=t,[n]=(0,d.useState)(()=>new h.qH);return(0,g.useServerInsertedHTML)(()=>{let t=n.getStyleElement();return n.instance.clearTag(),(0,i.jsx)(i.Fragment,{children:t})}),(0,i.jsx)(i.Fragment,{children:e})}function y(t){let{children:e}=t;return(0,i.jsx)("html",{lang:"en",children:(0,i.jsx)("body",{suppressHydrationWarning:!0,children:(0,i.jsx)(r.zt,{store:f(),children:(0,i.jsx)(p,{children:e})})})})}},8431:function(){},2344:function(t,e,n){"use strict";n.d(e,{RZ:function(){return U}}),"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(t,e,n){let i=Number(4294967295n&e),r=Number(e>>32n);this.setUint32(t+(n?0:4),i,n),this.setUint32(t+(n?4:0),r,n)}});var i=t=>new DataView(new ArrayBuffer(t)),r=t=>new Uint8Array(t.buffer||t),a=t=>(new TextEncoder).encode(String(t)),o=t=>Math.min(4294967295,Number(t)),s=t=>Math.min(65535,Number(t));function u(t,e=t){return new ReadableStream({async pull(e){let n=0;for(;e.desiredSize>n;){let o=await t.next();if(!o.value){e.close();break}{var i;let t="string"==typeof(i=o.value)?a(i):i instanceof Uint8Array?i:r(i);e.enqueue(t),n+=t.byteLength}}},cancel(t){e.throw?.(t)}})}function l(t,e,n){let[i,o]=e?e instanceof Uint8Array?[e,1]:ArrayBuffer.isView(e)||e instanceof ArrayBuffer?[r(e),1]:[a(e),0]:[void 0,0];if(t instanceof File)return{o:c(i||a(t.name)),u:BigInt(t.size),l:o};if(t instanceof Response){let e=t.headers.get("content-disposition"),r=e&&e.match(/;\s*filename\*?=["']?(.*?)["']?$/i),s=r&&r[1]||t.url&&new URL(t.url).pathname.split("/").findLast(Boolean),u=s&&decodeURIComponent(s),l=n||+t.headers.get("content-length");return{o:c(i||a(u)),u:BigInt(l),l:o}}return i=c(i,void 0!==t||void 0!==n),"string"==typeof t?{o:i,u:BigInt(a(t).length),l:o}:t instanceof Blob?{o:i,u:BigInt(t.size),l:o}:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?{o:i,u:BigInt(t.byteLength),l:o}:{o:i,u:n>-1?BigInt(n):t?void 0:0n,l:o}}function c(t,e=1){if(!t||t.every(t=>47===t))throw Error("The file must have a name.");if(e)for(;47===t[t.length-1];)t=t.subarray(0,-1);else 47!==t[t.length-1]&&(t=new Uint8Array([...t,47]));return t}var f=new Uint32Array(256);for(let t=0;t<256;++t){let e=t;for(let t=0;t<8;++t)e=e>>>1^(1&e&&3988292384);f[t]=e}function d(t,e=0){e^=-1;for(var n=0,i=t.length;n<i;n++)e=e>>>8^f[255&e^t[n]];return(-1^e)>>>0}function g(t,e,n=0){let i=t.getSeconds()>>1|t.getMinutes()<<5|t.getHours()<<11,r=t.getDate()|t.getMonth()+1<<5|t.getFullYear()-1980<<9;e.setUint16(n,i,1),e.setUint16(n+2,r,1)}var h=new TextDecoder("utf8",{fatal:1});async function*p(t){let{i:e}=t;if("then"in e&&(e=await e),e instanceof Uint8Array)yield e,t.m=d(e,0),t.u=BigInt(e.length);else{t.u=0n;let n=e.getReader();for(;;){let{value:e,done:i}=await n.read();if(i)break;t.m=d(e,t.m),t.u+=BigInt(e.length),yield e}}}function y(t){return t instanceof File||t instanceof Response?[[t],[t]]:[[t.input,t.name,t.size],[t.input,t.lastModified]]}var w=t=>(function(t){let e=BigInt(22),n=0n,i=0;for(let r of t){if(!r.o)throw Error("Every file must have a non-empty name.");if(void 0===r.u)throw Error(`Missing size for file "${(new TextDecoder).decode(r.o)}".`);let t=r.u>=4294967295n,a=n>=4294967295n;n+=BigInt(46+r.o.length+(t&&8))+r.u,e+=BigInt(r.o.length+46+(12*a|28*t)),i||(i=t)}return(i||n>=4294967295n)&&(e+=BigInt(76)),e+n})(function*(t){for(let e of t)yield l(...y(e)[0])}(t));function U(t,e={}){let n={"Content-Type":"application/zip","Content-Disposition":"attachment"};return("bigint"==typeof e.length||Number.isInteger(e.length))&&e.length>0&&(n["Content-Length"]=String(e.length)),e.metadata&&(n["Content-Length"]=String(w(e.metadata))),new Response(function(t,e={}){let n=function(t){let e=t[Symbol.iterator in t?Symbol.iterator:Symbol.asyncIterator]();return{async next(){let t=await e.next();if(t.done)return t;let[n,i]=y(t.value);return{done:0,value:Object.assign(function(t,e){if(void 0===e||e instanceof Date||(e=new Date(e)),t instanceof File)return{isFile:1,t:e||new Date(t.lastModified),i:t.stream()};if(t instanceof Response)return{isFile:1,t:e||new Date(t.headers.get("Last-Modified")||Date.now()),i:t.body};if(void 0===e)e=new Date;else if(isNaN(e))throw Error("Invalid modification date.");if(void 0===t)return{isFile:0,t:e};if("string"==typeof t)return{isFile:1,t:e,i:a(t)};if(t instanceof Blob)return{isFile:1,t:e,i:t.stream()};if(t instanceof Uint8Array||t instanceof ReadableStream)return{isFile:1,t:e,i:t};if(t instanceof ArrayBuffer||ArrayBuffer.isView(t))return{isFile:1,t:e,i:r(t)};if(Symbol.asyncIterator in t)return{isFile:1,t:e,i:u(t[Symbol.asyncIterator]())};throw TypeError("Unsupported input format.")}(...i),l(...n))}},throw:e.throw?.bind(e),[Symbol.asyncIterator](){return this}}}(t);return u(async function*(t,e){let n=[],a=0n,u=0n,l=0;for await(let s of t){let t=function({o:t,l:e},n){return 8*(!e||(n??function(t){try{h.decode(t)}catch{return 0}return 1}(t)))}(s,e.buffersAreUTF8);yield function(t,e=0){let n=i(30);return n.setUint32(0,1347093252),n.setUint32(4,754976768|e),g(t.t,n,10),n.setUint16(26,t.o.length,1),r(n)}(s,t),yield s.o,s.isFile&&(yield*p(s));let c=s.u>=4294967295n,f=12*(a>=4294967295n)|28*c;yield function(t,e){let n=i(16+(e?8:0));return n.setUint32(0,1347094280),n.setUint32(4,t.isFile?t.m:0,1),e?(n.setBigUint64(8,t.u,1),n.setBigUint64(16,t.u,1)):(n.setUint32(8,o(t.u),1),n.setUint32(12,o(t.u),1)),r(n)}(s,c),n.push(function(t,e,n=0,a=0){let s=i(46);return s.setUint32(0,1347092738),s.setUint32(4,755182848),s.setUint16(8,2048|n),g(t.t,s,12),s.setUint32(16,t.isFile?t.m:0,1),s.setUint32(20,o(t.u),1),s.setUint32(24,o(t.u),1),s.setUint16(28,t.o.length,1),s.setUint16(30,a,1),s.setUint16(40,t.isFile?33204:16893,1),s.setUint32(42,o(e),1),r(s)}(s,a,t,f)),n.push(s.o),f&&n.push(function(t,e,n){let a=i(n);return a.setUint16(0,1,1),a.setUint16(2,n-4,1),16&n&&(a.setBigUint64(4,t.u,1),a.setBigUint64(12,t.u,1)),a.setBigUint64(n-8,e,1),r(a)}(s,a,f)),c&&(a+=8n),u++,a+=BigInt(46+s.o.length)+s.u,l||(l=c)}let c=0n;for(let t of n)yield t,c+=BigInt(t.length);if(l||a>=4294967295n){let t=i(76);t.setUint32(0,1347094022),t.setBigUint64(4,BigInt(44),1),t.setUint32(12,755182848),t.setBigUint64(24,u,1),t.setBigUint64(32,u,1),t.setBigUint64(40,c,1),t.setBigUint64(48,a,1),t.setUint32(56,1347094023),t.setBigUint64(64,a+c,1),t.setUint32(72,1,1),yield r(t)}let f=i(22);f.setUint32(0,1347093766),f.setUint16(8,s(u),1),f.setUint16(10,s(u),1),f.setUint32(12,o(c),1),f.setUint32(16,o(a),1),yield r(f)}(n,e),n)}(t,e),{headers:n})}}},function(t){t.O(0,[738,225,971,69,744],function(){return t(t.s=4318)}),_N_E=t.O()}]);