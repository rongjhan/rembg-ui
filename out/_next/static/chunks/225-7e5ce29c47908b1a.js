"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[225],{1520:function(e,t,n){async function a(e){let{promise:t,resolve:n}=Promise.withResolvers(),a=new Image;return a.onload=function(){n("success")},"string"==typeof e?a.src=e:e instanceof HTMLImageElement?a.src=e.src:e instanceof Blob&&(a.src=URL.createObjectURL(e)),await t,e instanceof Blob&&URL.revokeObjectURL(a.src),a}async function i(e){let t=await a(e),n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;let i=n.getContext("2d");return i.drawImage(t,0,0),i.getImageData(0,0,n.width,n.height)}function l(e,t){let{promise:n,resolve:a,reject:l}=Promise.withResolvers();return Promise.all([i(e),i(t)]).then(e=>{let[t,n]=e;if(t.data.length!==n.data.length)throw Error("mask and image data length is not same");let i=document.createElement("canvas");i.width=t.width,i.height=t.height;let l=i.getContext("2d"),o=new ImageData(i.width,i.height);for(let e=0;e<t.data.length;e+=4)o.data[e]=t.data[e],o.data[e+1]=t.data[e+1],o.data[e+2]=t.data[e+2],o.data[e+3]=n.data[e];l.putImageData(o,0,0),i.toBlob(e=>{a(e)})}),n}n.d(t,{OI:function(){return a},ts:function(){return l}})},4577:function(e,t,n){function a(e,t,n,a,i,l){return a||(a=()=>null),{name:e,field_type:t,payload:n,next(){let e=a(this);return e&&(e.parent=this),e},parent:null!=i?i:null,prevNext:null!=l?l:null}}function i(e,t,n,a,i){return n||(n=()=>null),t||(t=()=>null),{name:e,member:t,next(){let e=n(this);return e&&(e.parent=this),e},parent:null!=a?a:null,prevNext:null!=i?i:null}}function l(e,t){if(e.member)for(let n of e.member()){if(n.payload&&n.name==t)return n;let e=n.next(n);if(e){let n=l(e,t);if(n)return n;continue}}else if(e.name==t)return e;let n=e.next(e);return n?l(n,t):null}function o(e,t,n){let a=l(e,t);if(a){let t;return a.payload.value=n,(t={...e}).next(t),t}throw"field ".concat(t," doesn't exist")}n.d(t,{By:function(){return i},kE:function(){return o},nb:function(){return a},wS:function(){return l}})},8823:function(e,t,n){var a,i,l,o,r,u;n.d(t,{Hn:function(){return a}}),(o=a||(a={})).ISNET="isnet-general-use",o.ISNET_ANIME="isnet-anime",o.U2NET="u2net",o.U2NET_HUMAN_SEG="u2net_human_seg",o.U2NET_CLOTH_SEG="u2net_cloth_seg",o.SILUETA="silueta",o.SAM_BASE="sam_base",o.SAM_LARGE="sam_large",o.SAM_HUGE="sam_huge",o.BIREFNET="birefnet",(r=i||(i={})).IN_POINTS="include_points",r.EX_POINTS="exclude_points",r.IN_BOX="include_box",(u=l||(l={})).DRAW="draw",u.Eraser="eraser"},6176:function(e,t,n){n.d(t,{E:function(){return r}});var a=n(7230),i=n(3741);console.log("dev:",!1);let l=(0,a.ni)(),o=(0,i.LC)({reducerPath:"processApi",baseQuery:(e,t,n)=>l(e,t,n),tagTypes:["InitMask","PostedMask"],endpoints:e=>({genInitMask:e.query({keepUnusedDataFor:0,providesTags:(e,t,n)=>[{type:"InitMask",id:n.rawImage.id}],queryFn:(e,t,n,a)=>{if(!e.model)return{data:null};{var i;console.log("send query");let t=new FormData;return t.append("model",e.model),t.append("content",e.rawImage.content),t.append("modelArgs",e.modelArgs?JSON.stringify(e.modelArgs):"{}"),t.append("alphaEstimate",JSON.stringify(null!==(i=e.alphaEstimate)&&void 0!==i&&i)),a({url:"/api/init_mask/",method:"POST",body:t,formData:!0,responseHandler:e=>e.blob()})}},serializeQueryArgs:e=>{let{queryArgs:t,endpointName:n}=e;return t!==a.CN?n+t.rawImage.id:a.CN}})})}),{genInitMask:r}=o.endpoints;t.Z=o},66:function(e,t,n){n.d(t,{$k:function(){return U},Fk:function(){return O},H7:function(){return _},KD:function(){return R},Lf:function(){return L},Xh:function(){return T},ef:function(){return A},hz:function(){return M},po:function(){return N},t1:function(){return S},z1:function(){return x},zs:function(){return C}});var a=n(6608),i=n(4577),l=n(8823);let o=(0,i.By)("editorRoot",()=>[r,u,s]),r=(0,i.nb)("imageID","input",{value:Symbol(void 0)},e=>void 0===e.payload.value?null:c),u=(0,i.nb)("showImages","switch",{value:!0}),s=(0,i.nb)("showCutouts","switch",{value:!0}),c=(0,i.nb)("stage","select",{value:"init",options:["init","modify"]},e=>{switch(e.payload.value){case"init":return d;case"modify":return m;default:throw"invalid value"}}),d=(0,i.By)("initOptions",()=>[f,y,E,p]),m=(0,i.By)("modifyOptions",()=>[w,v,k,g]),p=(0,i.nb)("runTimes","input",{value:"0"}),g=(0,i.nb)("cutTimes","input",{value:"0"}),f=(0,i.nb)("model","select",{value:"ISNET",options:Object.keys(l.Hn)},e=>e.payload.value.includes("SAM")?h:null),h=(0,i.nb)("markStyle","select",{value:"include_points",options:["include_points","exclude_points","include_box"]}),y=(0,i.nb)("alphaEstimate","switch",{value:!1}),w=(0,i.nb)("modifyTool","select",{value:"white",options:["white","black","eraser"]}),v=(0,i.nb)("modifyToolSize","input",{value:"14"}),E=(0,i.nb)("initLayer","select",{value:["mask","rawImg"],options:["mask","rawImg"]}),k=(0,i.nb)("modifyLayer","select",{value:["mask","rawImg"],options:["mask","rawImg"]}),b=(0,a.oM)({name:"editor",initialState:o,reducers:{changeshowImages:(e,t)=>(0,i.kE)(e,u.name,t.payload),changeRunTimes:(e,t)=>(0,i.kE)(e,p.name,"".concat(t.payload)),changeCutTimes:(e,t)=>(0,i.kE)(e,g.name,"".concat(t.payload)),changeshowCutouts:(e,t)=>(0,i.kE)(e,s.name,t.payload),loadImage:(e,t)=>(0,i.kE)(e,r.name,t.payload),changeEditStage:(e,t)=>(0,i.kE)(e,c.name,t.payload),changeModel:(e,t)=>(0,i.kE)(e,f.name,t.payload),changeAlphaEstimate:(e,t)=>(0,i.kE)(e,y.name,t.payload),changeMdoifyToolType:(e,t)=>(0,i.kE)(e,w.name,t.payload),changeModifyToolSize:(e,t)=>(0,i.kE)(e,v.name,t.payload),changeSamMarker:(e,t)=>(0,i.kE)(e,h.name,t.payload),changeInitLayer(e,t){let n=[...E.payload.value];return t.payload.checked?n.push(t.payload.value):n.splice(n.indexOf(t.payload.value),1),(0,i.kE)(e,E.name,n)},changeModifyLayer(e,t){let n=[...k.payload.value];return t.payload.checked?n.push(t.payload.value):n.splice(n.indexOf(t.payload.value),1),(0,i.kE)(e,k.name,n)}}});t.ZP=b;let{changeshowCutouts:I,changeshowImages:_,changeRunTimes:S,changeCutTimes:T,loadImage:N,changeModel:M,changeAlphaEstimate:O,changeEditStage:x,changeMdoifyToolType:L,changeModifyToolSize:A,changeSamMarker:U,changeInitLayer:R,changeModifyLayer:C}=b.actions},8377:function(e,t,n){n.d(t,{CM:function(){return u},Q9:function(){return o}});var a=n(6608),i=n(1520),l=n(2115);let o=(0,a.hg)("",async(e,t)=>{let n=await window.showOpenFilePicker({multiple:!0,types:[{description:"Images",accept:{"image/*":[".png",".bmp",".jpeg",".jpg",".svg"]}}]}),a=[];for await(let e of n){let t=URL.createObjectURL(await e.getFile()),{naturalWidth:n,naturalHeight:l}=await (0,i.OI)(t);a.push({fileHandle:e,id:crypto.randomUUID(),width:n,height:l,blobURL:t,content:await e.getFile()})}return a}),r=(0,a.oM)({name:"images",initialState:{images:[]},reducers:{removeImage(e,t){e.images.splice((0,l.Js)(e.images).indexOf(t.payload),1)}},extraReducers:e=>{e.addCase(o.fulfilled,(e,t)=>{e.images=[...e.images,...t.payload]})}}),{removeImage:u}=r.actions;t.ZP=r}}]);